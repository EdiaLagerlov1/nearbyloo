<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Datadog Logs SDK -->
    <script>
      (function(h,o,u,n,d) {
        h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
        d=o.createElement(u);d.async=1;d.src=n
        n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
      })(window,document,'script','https://www.datadoghq-browser-agent.com/us1/v4/datadog-rum.js','DD_RUM')
      
      DD_RUM.onReady(function() {
        DD_RUM.init({
          applicationId: 'YOUR_APPLICATION_ID', // Replace with your app ID from Datadog
          clientToken: 'pub12345678901234567890', // Replace with your actual client token
          site: 'datadoghq.com',
          service: 'nearbyloo',
          env: 'production',
          trackUserInteractions: true,
          trackResources: true,
          trackLongTasks: true,
          defaultPrivacyLevel: 'mask-user-input'
        });
        
        // Also initialize logs collection
        DD_RUM.startSessionReplayRecording();
      })
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NearbyLoo - Find Public Toilets</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XWV430YH6P"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XWV430YH6P');
    </script>
    
    <!-- Rest of your styles remain the same -->
    <style>
        /* Your existing styles */
        /* ... */
    </style>
</head>
<body>
    <!-- Your HTML remains the same -->
    <!-- ... -->

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Improved tracking function
        function trackFunction(fn, category, action) {
            return function(...args) {
                // Generate or get user ID
                if (!localStorage.getItem('app_user_id')) {
                    localStorage.setItem('app_user_id', 'user_' + Math.random().toString(36).substring(2, 15));
                }
                const userId = localStorage.getItem('app_user_id');
                
                // Track in Google Analytics
                if (window.gtag) {
                    gtag('event', action || fn.name, {
                        'event_category': category,
                        'event_label': JSON.stringify(args).substring(0, 100)
                    });
                }
                
                // Track in Datadog RUM
                if (window.DD_RUM && window.DD_RUM.addAction) {
                    DD_RUM.addAction(action || fn.name, {
                        category: category,
                        user_id: userId,
                        timestamp: new Date().toISOString(),
                        coordinates: args[0] && args[1] ? `${args[0]},${args[1]}` : null
                    });
                }
                
                // Call original function
                return fn.apply(this, args);
            };
        }
        
        // The rest of your code remains the same
        // ...
    </script>
</body>
</html>
